<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Generating data using synthpop methods | dsSynthetic: A DataSHIELD package to generate synthetic data</title>
  <meta name="description" content="The purpose of this book is to help the reader use dsSynthetic to help with data harmonisation and analysis when working on federated data sets with DataSHIELD" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Generating data using synthpop methods | dsSynthetic: A DataSHIELD package to generate synthetic data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The purpose of this book is to help the reader use dsSynthetic to help with data harmonisation and analysis when working on federated data sets with DataSHIELD" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Generating data using synthpop methods | dsSynthetic: A DataSHIELD package to generate synthetic data" />
  
  <meta name="twitter:description" content="The purpose of this book is to help the reader use dsSynthetic to help with data harmonisation and analysis when working on federated data sets with DataSHIELD" />
  

<meta name="author" content="Tom Bishop, Soumya Banerjee" />


<meta name="date" content="2022-02-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">dsSynthetic: Synthetic data generation with DataSHIELD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preliminaries</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#synopsis"><i class="fa fa-check"></i><b>1.1</b> Synopsis</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.2</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#assumptions"><i class="fa fa-check"></i><b>2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>2.2</b> Motivation</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#hypothesis-for-using-synthetic-data"><i class="fa fa-check"></i><b>2.3</b> Hypothesis for using synthetic data</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#overview-of-steps"><i class="fa fa-check"></i><b>2.4</b> Overview of steps</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#working-with-single-studies"><i class="fa fa-check"></i><b>2.5</b> Working with single studies</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#prerequisites"><i class="fa fa-check"></i><b>2.6</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="synthpop.html"><a href="synthpop.html"><i class="fa fa-check"></i><b>3</b> Generating data using synthpop methods</a><ul>
<li class="chapter" data-level="3.1" data-path="synthpop.html"><a href="synthpop.html#getting-set-up"><i class="fa fa-check"></i><b>3.1</b> Getting set up</a></li>
<li class="chapter" data-level="3.2" data-path="synthpop.html"><a href="synthpop.html#generate-synthetic-data-with-synthpop"><i class="fa fa-check"></i><b>3.2</b> Generate synthetic data with synthpop</a></li>
<li class="chapter" data-level="3.3" data-path="synthpop.html"><a href="synthpop.html#brief-comments-on-the-validity-of-the-data"><i class="fa fa-check"></i><b>3.3</b> Brief comments on the validity of the data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>4</b> Analysis with synthetic data</a><ul>
<li class="chapter" data-level="4.1" data-path="analysis.html"><a href="analysis.html#getting-set-up-1"><i class="fa fa-check"></i><b>4.1</b> Getting set up</a></li>
<li class="chapter" data-level="4.2" data-path="analysis.html"><a href="analysis.html#create-synthetic-dataset"><i class="fa fa-check"></i><b>4.2</b> Create synthetic dataset</a></li>
<li class="chapter" data-level="4.3" data-path="analysis.html"><a href="analysis.html#start-dslite-local-instance"><i class="fa fa-check"></i><b>4.3</b> Start DSLite local instance</a></li>
<li class="chapter" data-level="4.4" data-path="analysis.html"><a href="analysis.html#write-some-analysis-code"><i class="fa fa-check"></i><b>4.4</b> Write some analysis code</a></li>
<li class="chapter" data-level="4.5" data-path="analysis.html"><a href="analysis.html#run-corrected-code-on-real-data"><i class="fa fa-check"></i><b>4.5</b> Run corrected code on real data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="harmonisation.html"><a href="harmonisation.html"><i class="fa fa-check"></i><b>5</b> Harmonisation with synthetic data</a><ul>
<li class="chapter" data-level="5.1" data-path="harmonisation.html"><a href="harmonisation.html#getting-set-up-2"><i class="fa fa-check"></i><b>5.1</b> Getting set up</a></li>
<li class="chapter" data-level="5.2" data-path="harmonisation.html"><a href="harmonisation.html#experiment-with-a-single-row"><i class="fa fa-check"></i><b>5.2</b> Experiment with a single row</a></li>
<li class="chapter" data-level="5.3" data-path="harmonisation.html"><a href="harmonisation.html#test-on-whole-dataset"><i class="fa fa-check"></i><b>5.3</b> Test on whole dataset</a></li>
<li class="chapter" data-level="5.4" data-path="harmonisation.html"><a href="harmonisation.html#run-the-code-on-the-real-data"><i class="fa fa-check"></i><b>5.4</b> Run the code on the real data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="simstudy.html"><a href="simstudy.html"><i class="fa fa-check"></i><b>6</b> Generating data using simstudy methods</a><ul>
<li class="chapter" data-level="6.1" data-path="simstudy.html"><a href="simstudy.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="simstudy.html"><a href="simstudy.html#getting-set-up-3"><i class="fa fa-check"></i><b>6.2</b> Getting set up</a></li>
<li class="chapter" data-level="6.3" data-path="simstudy.html"><a href="simstudy.html#preparing-to-generate-synthetic-data"><i class="fa fa-check"></i><b>6.3</b> Preparing to generate synthetic data</a></li>
<li class="chapter" data-level="6.4" data-path="simstudy.html"><a href="simstudy.html#generating-synthetic-data"><i class="fa fa-check"></i><b>6.4</b> Generating synthetic data</a></li>
<li class="chapter" data-level="6.5" data-path="simstudy.html"><a href="simstudy.html#brief-comments-on-the-validity-of-the-data-1"><i class="fa fa-check"></i><b>6.5</b> Brief comments on the validity of the data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">dsSynthetic: A DataSHIELD package to generate synthetic data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="synthpop" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Generating data using synthpop methods</h1>
<p>In this chapter we will look at how to generate synthetic data on the server side using DataSHIELD functions, based on <strong>synthpop</strong> functionality. In this scenario the synthetic data is generated on the server side and returned to the client.</p>
<p>The <code>syn</code> function in the <strong>synthpop</strong> package has many detailed options for optimising the generation of synthetic data. A limited number of these options are available in the <strong>dsSynthetic</strong> package. Details of how to use these options can be found in the vignettes for <strong>synthpop</strong>.</p>
<div id="getting-set-up" class="section level2">
<h2><span class="header-section-number">3.1</span> Getting set up</h2>
<p>First we need to build a login object for the server that holds the data. Note that the <strong>dsSynthetic</strong> functions have been written to work with a connection to a single server:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="synthpop.html#cb1-1"></a>builder &lt;-<span class="st"> </span>DSI<span class="op">::</span><span class="kw">newDSLoginBuilder</span>()</span>
<span id="cb1-2"><a href="synthpop.html#cb1-2"></a><span class="co"># hide credentials</span></span>
<span id="cb1-3"><a href="synthpop.html#cb1-3"></a>builder<span class="op">$</span><span class="kw">append</span>(<span class="dt">server=</span><span class="st">&quot;server1&quot;</span>, <span class="dt">url=</span><span class="st">&quot;https://opal-sandbox.mrc-epid.cam.ac.uk&quot;</span>,</span>
<span id="cb1-4"><a href="synthpop.html#cb1-4"></a>               <span class="dt">user=</span><span class="st">&quot;dsuser&quot;</span>, <span class="dt">password=</span><span class="st">&quot;P@ssw0rd&quot;</span>, </span>
<span id="cb1-5"><a href="synthpop.html#cb1-5"></a>               <span class="dt">table =</span> <span class="st">&quot;DASIM.DASIM1&quot;</span>)</span>
<span id="cb1-6"><a href="synthpop.html#cb1-6"></a>logindata &lt;-<span class="st"> </span>builder<span class="op">$</span><span class="kw">build</span>()</span></code></pre></div>
<p>And then we establish a connection to the server:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="synthpop.html#cb2-1"></a><span class="kw">library</span>(DSOpal)</span>
<span id="cb2-2"><a href="synthpop.html#cb2-2"></a><span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;connections&quot;</span>)){</span>
<span id="cb2-3"><a href="synthpop.html#cb2-3"></a>  <span class="kw">datashield.logout</span>(<span class="dt">conns =</span> connections)</span>
<span id="cb2-4"><a href="synthpop.html#cb2-4"></a>}</span>
<span id="cb2-5"><a href="synthpop.html#cb2-5"></a>connections &lt;-<span class="st"> </span><span class="kw">datashield.login</span>(<span class="dt">logins=</span>logindata, <span class="dt">assign =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>
<div id="generate-synthetic-data-with-synthpop" class="section level2">
<h2><span class="header-section-number">3.2</span> Generate synthetic data with synthpop</h2>
<p>The recommended way to generate a synthetic dataset is by using an implementation of the <strong>synthpop</strong> package on the server side. <strong>synthpop</strong> requires some thought on the part of the user: if you have a data set with a large number of columns it may take a large amount of time to generate the synthetic data. Assuming we have a data set with a small number of columns (i.e. around 10) we can simply execute the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="synthpop.html#cb3-1"></a><span class="kw">library</span>(dsSyntheticClient)</span>
<span id="cb3-2"><a href="synthpop.html#cb3-2"></a><span class="kw">library</span>(dsBaseClient)</span>
<span id="cb3-3"><a href="synthpop.html#cb3-3"></a><span class="co"># N.B. you may need to replace `server1` if you have named your connection differently</span></span>
<span id="cb3-4"><a href="synthpop.html#cb3-4"></a>synth_data =<span class="st"> </span><span class="kw">ds.syn</span>(<span class="dt">data =</span> <span class="st">&quot;D&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;cart&quot;</span>, <span class="dt">m =</span> <span class="dv">1</span>, <span class="dt">seed =</span> <span class="dv">123</span>)<span class="op">$</span>server1<span class="op">$</span>syn</span></code></pre></div>
<p>We then have the synthetic data on the client side and can view and manipulate it as required:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="synthpop.html#cb4-1"></a><span class="kw">head</span>(synth_data)</span></code></pre></div>
<pre><code>##        LAB_TSC  LAB_TRIG  LAB_HDL LAB_GLUC_FASTING PM_BMI_CONTINUOUS DIS_CVA
## 1     5.789247 2.8768744 1.261161         2.581984          21.42926       0
## 10    5.338826 0.7885768 1.609632         4.168195          31.29042       0
## 100   4.334922 2.5569000 1.097729         5.143301          19.73722       0
## 1000  6.311116 1.3648574 1.955236         3.813377          20.91334       0
## 10000 8.346605 1.9988410 1.592837         3.683666          24.18755       0
## 1001  5.139364 1.6111131 1.569089         4.860442          33.14083       0
##       DIS_DIAB DIS_AMI GENDER PM_BMI_CATEGORICAL
## 1            0       0      0                  1
## 10           0       0      0                  3
## 100          0       0      1                  1
## 1000         0       0      0                  1
## 10000        0       0      1                  1
## 1001         0       0      1                  3</code></pre>
<p>If you have a dataset with a larger number of columns, you could generate a synthetic dataset for a subset of the variables that you need to generate a particular part of your code development. For example if we needed to generate a diabetes variable based on blood triglycerides, HDL and glucose we could just generate a dataset for those variables:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="synthpop.html#cb6-1"></a><span class="kw">ds.subset</span>(<span class="dt">x =</span> <span class="st">&quot;D&quot;</span>, <span class="dt">subset =</span> <span class="st">&quot;D2&quot;</span>, <span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;LAB_HDL&quot;</span>, <span class="st">&quot;LAB_TRIG&quot;</span>, <span class="st">&quot;LAB_GLUC_FASTING&quot;</span>))</span>
<span id="cb6-2"><a href="synthpop.html#cb6-2"></a><span class="co"># N.B. you may need to replace `server1` if you have named your connection differently</span></span>
<span id="cb6-3"><a href="synthpop.html#cb6-3"></a>synth_data_sub =<span class="st"> </span><span class="kw">ds.syn</span>(<span class="dt">data =</span> <span class="st">&quot;D2&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;cart&quot;</span>, <span class="dt">m =</span> <span class="dv">1</span>, <span class="dt">seed =</span> <span class="dv">123</span>)<span class="op">$</span>server1<span class="op">$</span>syn</span>
<span id="cb6-4"><a href="synthpop.html#cb6-4"></a><span class="kw">head</span>(synth_data_sub)</span></code></pre></div>
<pre><code>##        LAB_HDL  LAB_TRIG LAB_GLUC_FASTING
## 1     1.010557 4.1407950         5.602287
## 10    1.279467 0.6393019         4.111829
## 100   1.307681 2.5400787         4.522174
## 1000  1.430441 2.7499347         5.234948
## 10000 1.219077 1.5141544         3.869419
## 1001  1.550882 2.9557399         4.929816</code></pre>
<p>Lastly we save our data for later chapters:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="synthpop.html#cb8-1"></a><span class="kw">write.csv</span>(<span class="dt">x =</span> synth_data, <span class="dt">file =</span> <span class="st">&quot;data/synth_data.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="brief-comments-on-the-validity-of-the-data" class="section level2">
<h2><span class="header-section-number">3.3</span> Brief comments on the validity of the data</h2>
<p>In the example above we chose to synthetically generate the variable <code>PM_BMI_CATEGORICAL</code>. This variable is actually derived from the continuous variable <code>PM_BMI_CONTINUOUS</code>, with (say) BMI &lt;25 being category 1, 25&lt;= BMI &lt; 30 being category 2 etc. Because of the probabilistic way in which the data are generated, this categorisation is not enforced in the data synthesis. It might be better to generate the continuous variable only and add the categorical variable afterwards.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["synthetic_bookdown.pdf", "synthetic_bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
