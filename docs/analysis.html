<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Analysis with synthetic data | dsSynthetic: A DataSHIELD package to generate synthetic data</title>
  <meta name="description" content="The purpose of this book is to help the reader use dsSynthetic to help with data harmonisation and analysis when working on federated data sets with DataSHIELD" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Analysis with synthetic data | dsSynthetic: A DataSHIELD package to generate synthetic data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The purpose of this book is to help the reader use dsSynthetic to help with data harmonisation and analysis when working on federated data sets with DataSHIELD" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Analysis with synthetic data | dsSynthetic: A DataSHIELD package to generate synthetic data" />
  
  <meta name="twitter:description" content="The purpose of this book is to help the reader use dsSynthetic to help with data harmonisation and analysis when working on federated data sets with DataSHIELD" />
  

<meta name="author" content="Tom Bishop, Soumya Banerjee" />


<meta name="date" content="2022-05-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="synthpop.html"/>
<link rel="next" href="harmonisation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">dsSynthetic: Synthetic data generation with DataSHIELD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preliminaries</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#synopsis"><i class="fa fa-check"></i><b>1.1</b> Synopsis</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.2</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#assumptions"><i class="fa fa-check"></i><b>2.1</b> Assumptions</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>2.2</b> Motivation</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#hypothesis-for-using-synthetic-data"><i class="fa fa-check"></i><b>2.3</b> Hypothesis for using synthetic data</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#overview-of-steps"><i class="fa fa-check"></i><b>2.4</b> Overview of steps</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#working-with-single-studies"><i class="fa fa-check"></i><b>2.5</b> Working with single studies</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#prerequisites"><i class="fa fa-check"></i><b>2.6</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="synthpop.html"><a href="synthpop.html"><i class="fa fa-check"></i><b>3</b> Generating data using synthpop methods</a><ul>
<li class="chapter" data-level="3.1" data-path="synthpop.html"><a href="synthpop.html#getting-set-up"><i class="fa fa-check"></i><b>3.1</b> Getting set up</a></li>
<li class="chapter" data-level="3.2" data-path="synthpop.html"><a href="synthpop.html#generate-synthetic-data-with-synthpop"><i class="fa fa-check"></i><b>3.2</b> Generate synthetic data with synthpop</a></li>
<li class="chapter" data-level="3.3" data-path="synthpop.html"><a href="synthpop.html#brief-comments-on-the-validity-of-the-data"><i class="fa fa-check"></i><b>3.3</b> Brief comments on the validity of the data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>4</b> Analysis with synthetic data</a><ul>
<li class="chapter" data-level="4.1" data-path="analysis.html"><a href="analysis.html#getting-set-up-1"><i class="fa fa-check"></i><b>4.1</b> Getting set up</a></li>
<li class="chapter" data-level="4.2" data-path="analysis.html"><a href="analysis.html#create-synthetic-dataset"><i class="fa fa-check"></i><b>4.2</b> Create synthetic dataset</a></li>
<li class="chapter" data-level="4.3" data-path="analysis.html"><a href="analysis.html#start-dslite-local-instance"><i class="fa fa-check"></i><b>4.3</b> Start DSLite local instance</a></li>
<li class="chapter" data-level="4.4" data-path="analysis.html"><a href="analysis.html#write-some-analysis-code"><i class="fa fa-check"></i><b>4.4</b> Write some analysis code</a></li>
<li class="chapter" data-level="4.5" data-path="analysis.html"><a href="analysis.html#run-corrected-code-on-real-data"><i class="fa fa-check"></i><b>4.5</b> Run corrected code on real data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="harmonisation.html"><a href="harmonisation.html"><i class="fa fa-check"></i><b>5</b> Harmonisation with synthetic data</a><ul>
<li class="chapter" data-level="5.1" data-path="harmonisation.html"><a href="harmonisation.html#getting-set-up-2"><i class="fa fa-check"></i><b>5.1</b> Getting set up</a></li>
<li class="chapter" data-level="5.2" data-path="harmonisation.html"><a href="harmonisation.html#experiment-with-a-single-row"><i class="fa fa-check"></i><b>5.2</b> Experiment with a single row</a></li>
<li class="chapter" data-level="5.3" data-path="harmonisation.html"><a href="harmonisation.html#test-on-whole-dataset"><i class="fa fa-check"></i><b>5.3</b> Test on whole dataset</a></li>
<li class="chapter" data-level="5.4" data-path="harmonisation.html"><a href="harmonisation.html#run-the-code-on-the-real-data"><i class="fa fa-check"></i><b>5.4</b> Run the code on the real data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="simstudy.html"><a href="simstudy.html"><i class="fa fa-check"></i><b>6</b> Generating data using simstudy methods</a><ul>
<li class="chapter" data-level="6.1" data-path="simstudy.html"><a href="simstudy.html#overview"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="simstudy.html"><a href="simstudy.html#getting-set-up-3"><i class="fa fa-check"></i><b>6.2</b> Getting set up</a></li>
<li class="chapter" data-level="6.3" data-path="simstudy.html"><a href="simstudy.html#preparing-to-generate-synthetic-data"><i class="fa fa-check"></i><b>6.3</b> Preparing to generate synthetic data</a></li>
<li class="chapter" data-level="6.4" data-path="simstudy.html"><a href="simstudy.html#generating-synthetic-data"><i class="fa fa-check"></i><b>6.4</b> Generating synthetic data</a></li>
<li class="chapter" data-level="6.5" data-path="simstudy.html"><a href="simstudy.html#brief-comments-on-the-validity-of-the-data-1"><i class="fa fa-check"></i><b>6.5</b> Brief comments on the validity of the data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">dsSynthetic: A DataSHIELD package to generate synthetic data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Analysis with synthetic data</h1>
<p>In this section we describe how we can use a copy of the synthetic data to help users write DataSHIELD analysis code. Again we will make use of an existing data set.</p>
<p>Recall that the objective here is to use a synthetic copy of already harmonised real data that is then made available to the analyst on the client side. This synthetic data set can be loaded into <strong>DSLite</strong>, a special client side implementation of server side DataSHIELD used for development purposes. <strong>DSLite</strong> is will only take standard DataSHIELD functions as input, but the user can have full access to the data through a special interface. This is acceptable in this situation as the data are synthetic and designed to be non-disclosive. Therefore the user has the chance to write DataSHIELD code but see the complete results of each step. This makes it easier to develop the code.</p>
<p>The steps are summarised as:</p>
<ol style="list-style-type: decimal">
<li>User requests synthetic copy of real data</li>
<li>Synthetic data generated &amp; available on client side</li>
<li>Synthetic data placed in DSLite environment that simulates server side DataSHIELD environment</li>
<li>Develop DataSHIELD code against synthetic data in DSLite (with full access to synthetic data)</li>
<li>When DataSHIELD code is complete, run code against real data on server side</li>
</ol>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="images/dssynthetic_analysis.png" alt="Prototyping DataSHIELD analysis using synthetic data on DSLite" width="314" />
<p class="caption">
Figure 4.1: Prototyping DataSHIELD analysis using synthetic data on DSLite
</p>
</div>
<div id="getting-set-up-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Getting set up</h2>
<p>Let us assume that the <em>DASIM1</em> dataset has previously been harmonised and is held on a server. As normal with DataSHIELD, we do not have complete access to the full data set but want to do some analysis on it. Using the method described above, the first thing to do is generate a synthetic version of the data that we can fully access. To do this we will use the same steps that were shown in <a href="synthpop.html#synthpop">3</a></p>
<p>We build our log in object</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="analysis.html#cb1-1"></a>builder &lt;-<span class="st"> </span>DSI<span class="op">::</span><span class="kw">newDSLoginBuilder</span>()</span>
<span id="cb1-2"><a href="analysis.html#cb1-2"></a>builder<span class="op">$</span><span class="kw">append</span>(<span class="dt">server=</span><span class="st">&quot;server1&quot;</span>, <span class="dt">url=</span><span class="st">&quot;https://opal-sandbox.mrc-epid.cam.ac.uk&quot;</span>,</span>
<span id="cb1-3"><a href="analysis.html#cb1-3"></a>               <span class="dt">user=</span><span class="st">&quot;dsuser&quot;</span>, <span class="dt">password=</span><span class="st">&quot;P@ssw0rd&quot;</span>, </span>
<span id="cb1-4"><a href="analysis.html#cb1-4"></a>               <span class="dt">table =</span> <span class="st">&quot;DASIM.DASIM1&quot;</span>)</span>
<span id="cb1-5"><a href="analysis.html#cb1-5"></a>logindata &lt;-<span class="st"> </span>builder<span class="op">$</span><span class="kw">build</span>()</span></code></pre></div>
<p>Then perform the log in to the server:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="analysis.html#cb2-1"></a><span class="kw">library</span>(DSOpal)</span>
<span id="cb2-2"><a href="analysis.html#cb2-2"></a><span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;connections&quot;</span>)){</span>
<span id="cb2-3"><a href="analysis.html#cb2-3"></a>  <span class="kw">datashield.logout</span>(<span class="dt">conns =</span> connections)</span>
<span id="cb2-4"><a href="analysis.html#cb2-4"></a>}</span>
<span id="cb2-5"><a href="analysis.html#cb2-5"></a>connections &lt;-<span class="st"> </span><span class="kw">datashield.login</span>(<span class="dt">logins=</span>logindata, <span class="dt">assign =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
</div>
<div id="create-synthetic-dataset" class="section level2">
<h2><span class="header-section-number">4.2</span> Create synthetic dataset</h2>
<p>The <em>DASIM1</em> dataset is relatively small (i.e. around 10 columns). This is probably also true of many harmonised data sets.
Therefore we can just create a synthetic version of it in its entirety without specifying a subset of columns:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="analysis.html#cb3-1"></a><span class="kw">library</span>(dsSyntheticClient)</span>
<span id="cb3-2"><a href="analysis.html#cb3-2"></a>synth_data =<span class="st"> </span><span class="kw">ds.syn</span>(<span class="dt">data =</span> <span class="st">&quot;D&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;cart&quot;</span>, <span class="dt">m =</span> <span class="dv">1</span>, <span class="dt">seed =</span> <span class="dv">123</span>)</span>
<span id="cb3-3"><a href="analysis.html#cb3-3"></a><span class="co"># N.B. you may need to replace `server1` if you have named your connection differently</span></span>
<span id="cb3-4"><a href="analysis.html#cb3-4"></a>DASIM =<span class="st"> </span>synth_data<span class="op">$</span>server1<span class="op">$</span>Data<span class="op">$</span>syn</span></code></pre></div>
</div>
<div id="start-dslite-local-instance" class="section level2">
<h2><span class="header-section-number">4.3</span> Start DSLite local instance</h2>
<p>Here we start our <code>DSLite</code> instance, and load the <em>DASIM</em> data. Recall that this simulates the server side environment on your client, but with the ability to access all the data. Therefore it is ideal for our requirement to build a code pipeline while being able to see the data: this helps with the debugging and logic checking process.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="analysis.html#cb4-1"></a><span class="kw">library</span>(DSLite)</span>
<span id="cb4-2"><a href="analysis.html#cb4-2"></a><span class="kw">library</span>(dsBaseClient)</span>
<span id="cb4-3"><a href="analysis.html#cb4-3"></a>dslite.server &lt;-<span class="st"> </span><span class="kw">newDSLiteServer</span>(<span class="dt">tables=</span><span class="kw">list</span>(<span class="dt">DASIM=</span>DASIM))</span>
<span id="cb4-4"><a href="analysis.html#cb4-4"></a>dslite.server<span class="op">$</span><span class="kw">config</span>(<span class="kw">defaultDSConfiguration</span>(<span class="dt">include=</span><span class="kw">c</span>(<span class="st">&quot;dsBase&quot;</span>, <span class="st">&quot;dsSynthetic&quot;</span>)))</span>
<span id="cb4-5"><a href="analysis.html#cb4-5"></a></span>
<span id="cb4-6"><a href="analysis.html#cb4-6"></a>builder &lt;-<span class="st"> </span>DSI<span class="op">::</span><span class="kw">newDSLoginBuilder</span>()</span>
<span id="cb4-7"><a href="analysis.html#cb4-7"></a>builder<span class="op">$</span><span class="kw">append</span>(<span class="dt">server=</span><span class="st">&quot;server1&quot;</span>, <span class="dt">url=</span><span class="st">&quot;dslite.server&quot;</span>, <span class="dt">table =</span> <span class="st">&quot;DASIM&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;DSLiteDriver&quot;</span>)</span>
<span id="cb4-8"><a href="analysis.html#cb4-8"></a>logindata &lt;-<span class="st"> </span>builder<span class="op">$</span><span class="kw">build</span>()</span>
<span id="cb4-9"><a href="analysis.html#cb4-9"></a></span>
<span id="cb4-10"><a href="analysis.html#cb4-10"></a><span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;connections&quot;</span>)){</span>
<span id="cb4-11"><a href="analysis.html#cb4-11"></a>  <span class="kw">datashield.logout</span>(<span class="dt">conns =</span> connections)</span>
<span id="cb4-12"><a href="analysis.html#cb4-12"></a>}</span>
<span id="cb4-13"><a href="analysis.html#cb4-13"></a>connections &lt;-<span class="st"> </span><span class="kw">datashield.login</span>(<span class="dt">logins=</span>logindata, <span class="dt">assign =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>We can now check for ourselves that our <em>DASIM</em> data is in the DSLite server:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="analysis.html#cb5-1"></a><span class="kw">ds.summary</span>(<span class="st">&#39;D&#39;</span>)</span></code></pre></div>
<pre><code>## $server1
## $server1$class
## [1] &quot;data.frame&quot;
## 
## $server1$`number of rows`
## [1] 10000
## 
## $server1$`number of columns`
## [1] 10
## 
## $server1$`variables held`
##  [1] &quot;LAB_TSC&quot;            &quot;LAB_TRIG&quot;           &quot;LAB_HDL&quot;           
##  [4] &quot;LAB_GLUC_FASTING&quot;   &quot;PM_BMI_CONTINUOUS&quot;  &quot;DIS_CVA&quot;           
##  [7] &quot;DIS_DIAB&quot;           &quot;DIS_AMI&quot;            &quot;GENDER&quot;            
## [10] &quot;PM_BMI_CATEGORICAL&quot;</code></pre>
</div>
<div id="write-some-analysis-code" class="section level2">
<h2><span class="header-section-number">4.4</span> Write some analysis code</h2>
<p>Now suppose we want to subset the <em>DASIM</em> data into men and women. We can use the <code>ds.subset</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="analysis.html#cb7-1"></a><span class="kw">ds.subset</span>(<span class="dt">x=</span><span class="st">&quot;D&quot;</span>, <span class="dt">subset =</span> <span class="st">&quot;women&quot;</span>, <span class="dt">logicalOperator =</span> <span class="st">&quot;==&quot;</span>, <span class="dt">threshold =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>With DSLite we have the chance to look at actually what happened in detail:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="analysis.html#cb8-1"></a><span class="co"># N.B. you may need to replace `server1` if you have named your connection differently</span></span>
<span id="cb8-2"><a href="analysis.html#cb8-2"></a>women =<span class="st"> </span><span class="kw">getDSLiteData</span>(<span class="dt">conns =</span> connections, <span class="dt">symbol =</span> <span class="st">&quot;women&quot;</span>)<span class="op">$</span>server1</span>
<span id="cb8-3"><a href="analysis.html#cb8-3"></a><span class="kw">head</span>(women)</span></code></pre></div>
<pre><code>##        LAB_TSC  LAB_TRIG   LAB_HDL LAB_GLUC_FASTING PM_BMI_CONTINUOUS DIS_CVA
## 1     5.716675 1.2131437 1.2263569         4.746905          28.30447       0
## 10    5.635550 1.0352904 0.9980688         4.724115          26.40500       0
## 100   4.304612 0.2782473 1.7977266         3.922677          28.83399       0
## 1000  6.250217 0.8718639 1.8747723         3.457615          23.08530       0
## 10000 8.621496 4.3548597 1.1010694         4.637112          27.85634       0
## 1001  5.026787 2.2295412 1.1088745         3.802152          21.22769       0
##       DIS_DIAB DIS_AMI GENDER PM_BMI_CATEGORICAL
## 1            0       0      0                  2
## 10           0       0      1                  2
## 100          0       0      1                  2
## 1000         0       0      1                  1
## 10000        0       0      0                  2
## 1001         0       0      0                  1</code></pre>
<p>This doesn’t look quite right. There are still rows with <code>GENDER == 0</code>. There is an error in our code (we didn’t specify <code>GENDER</code> as part of the logicalOperator parameter) but didn’t get a warning. Let’s make a correction and try again:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="analysis.html#cb10-1"></a><span class="kw">ds.subset</span>(<span class="dt">x=</span><span class="st">&quot;D&quot;</span>, <span class="dt">subset =</span> <span class="st">&quot;women&quot;</span>, <span class="dt">logicalOperator =</span> <span class="st">&quot;GENDER==&quot;</span>, <span class="dt">threshold =</span> <span class="dv">1</span>)</span>
<span id="cb10-2"><a href="analysis.html#cb10-2"></a><span class="co"># get the data again</span></span>
<span id="cb10-3"><a href="analysis.html#cb10-3"></a><span class="co"># N.B. you may need to replace `server1` if you have named your connection differently</span></span>
<span id="cb10-4"><a href="analysis.html#cb10-4"></a>women =<span class="st"> </span><span class="kw">getDSLiteData</span>(<span class="dt">conns =</span> connections, <span class="dt">symbol =</span> <span class="st">&quot;women&quot;</span>)<span class="op">$</span>server1</span>
<span id="cb10-5"><a href="analysis.html#cb10-5"></a><span class="kw">head</span>(women)</span></code></pre></div>
<pre><code>##       LAB_TSC   LAB_TRIG   LAB_HDL LAB_GLUC_FASTING PM_BMI_CONTINUOUS DIS_CVA
## 10   5.635550  1.0352904 0.9980688         4.724115          26.40500       0
## 100  4.304612  0.2782473 1.7977266         3.922677          28.83399       0
## 1000 6.250217  0.8718639 1.8747723         3.457615          23.08530       0
## 1002 5.743905  2.6050324 1.0818273         4.285118          30.99263       0
## 1004 4.054283 -0.8651860 2.3976915         4.419434          23.00676       0
## 1005 4.565802  1.8247904 1.4323840         5.322401          36.89399       0
##      DIS_DIAB DIS_AMI GENDER PM_BMI_CATEGORICAL
## 10          0       0      1                  2
## 100         0       0      1                  2
## 1000        0       0      1                  1
## 1002        0       0      1                  3
## 1004        0       0      1                  1
## 1005        0       0      1                  3</code></pre>
<p>This now looks much better.</p>
</div>
<div id="run-corrected-code-on-real-data" class="section level2">
<h2><span class="header-section-number">4.5</span> Run corrected code on real data</h2>
<p>We can also compare results obtained via DataSHIELD with results on the actual data:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="analysis.html#cb12-1"></a>from_server =<span class="st"> </span><span class="kw">ds.glm</span>(<span class="dt">formula =</span> <span class="st">&quot;DIS_DIAB~PM_BMI_CONTINUOUS+LAB_TSC+LAB_HDL&quot;</span>, <span class="dt">data =</span> <span class="st">&quot;women&quot;</span>, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb12-2"><a href="analysis.html#cb12-2"></a>from_local =<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> <span class="st">&quot;DIS_DIAB~PM_BMI_CONTINUOUS+LAB_TSC+LAB_HDL&quot;</span>, <span class="dt">data =</span> women, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb12-3"><a href="analysis.html#cb12-3"></a></span>
<span id="cb12-4"><a href="analysis.html#cb12-4"></a>from_server<span class="op">$</span>coefficients</span></code></pre></div>
<pre><code>##                     Estimate Std. Error   z-value      p-value low0.95CI.LP
## (Intercept)       -5.9908647 0.95366097 -6.281965 3.343205e-10  -7.86000582
## PM_BMI_CONTINUOUS  0.1428793 0.02249027  6.352938 2.112405e-10   0.09879916
## LAB_TSC           -0.2090230 0.09820091 -2.128524 3.329370e-02  -0.40149320
## LAB_HDL           -0.5191230 0.28273998 -1.836044 6.635116e-02  -1.07328321
##                   high0.95CI.LP        P_OR low0.95CI.P_OR high0.95CI.P_OR
## (Intercept)         -4.12172352 0.002495258   0.0003857228      0.01595776
## PM_BMI_CONTINUOUS    0.18695938 1.153590520   1.1038445800      1.20557831
## LAB_TSC             -0.01655271 0.811376611   0.6693198696      0.98358354
## LAB_HDL              0.03503715 0.595042151   0.3418841935      1.03565818</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="analysis.html#cb14-1"></a>from_local<span class="op">$</span>coefficients</span></code></pre></div>
<pre><code>##       (Intercept) PM_BMI_CONTINUOUS           LAB_TSC           LAB_HDL 
##        -5.9908647         0.1428793        -0.2090230        -0.5191230</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="synthpop.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="harmonisation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["synthetic_bookdown.pdf", "synthetic_bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
